<!DOCTYPE html>
<html lang="en" >

    <head>
        <meta charset="UTF-8">
        <title>芯机智科技- WITKIT.CN</title>
        <link rel="stylesheet" href="static/login/login-concept/css/style.css">

        <script type="text/javascript"> witkit_server = 'witkit.cn'; </script>
        <script src='static/js/jquery-2.1.1.min.js'></script>
        <script src='static/js/jquery-2.1.1.min.js'></script>
        <script src="static/login/login-concept/js/index.js"></script>
        <link href="static/bar/my-navbar/css/demo-3/hover-min.css" rel="stylesheet" media="all">
        <style>
/*
body{  
    background:url(http://www.pptbz.com/pptpic/UploadFiles_6909/201105/2011051823374471.jpg);  
    filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod='scale')";  
    -moz-background-size:100% 100%;  
    background-size:100% 100%;  
    background-attachment: fixed;
} 
*/
        </style>
    </head>

    <body class="demo">
        <div  onclick="window.open('/','_self','')" nowrap style="position: absolute; top: 32px; left: 80px; ">
            <a   class="hvr-buzz"  onselectstart="return false;" style="cursor: pointer;  top: 16px;font-weight:bold; font-family:verdana,arial,sans-serif; font-size:32px;color:#49A3FF;">
                WITKIT 
            </a>
        </div>
        <div nowrap style="position: absolute; top: 38px; left: 190px; ">
            <a  style="top: 16px; letter-spacing:6px; font-size:22px; ;color:#fffffff2; font-family:Microsoft YaHei,微软雅黑,Tahoma,Verdana;">
                &nbsp;&nbsp;&nbsp;芯机智
            </a>
        </div>

        <div class="wrapper center" style="height:35px">
            <h1 style="font-size:32px; color:#fffffff2;font-family:youyuan;">登录云端</h1>
            <div class="anim-input ripple" data-ripple-color="#383838">
                <div class="label">请输入用户名</div>
                <input type="text" id="input_user">
            </div>
            <div class="anim-input ripple" data-ripple-color="#383838">
                <div class="label">请输入密码</div>
                <input type="password" id="input_pass">
            </div>

            <button id="but1" onclick="window.location.href='javascript:doPost()'" class="ripple" data-ripple-color="#000">登录</button>
            
            <script  src="static/pure-css3-colorful-loading/js/index.js"></script>
            <link rel="stylesheet" href="static/pure-css3-colorful-loading/css/style.css">
            <div id="error_log" style="visibility:hidden;Margin:12px 0px 0px 0px;color:#FF6A6A;">
                <a>帐号或密码错误!</a>
            </div>
            <div id="ajaxloader3" style="visibility:hidden;Margin:16px 0px -16px 0px;">
                <div class="outer"></div>
                <div class="inner"></div>
            </div>

        <footer style="font-size:20px"> © WWW.WITKIT.CN 版权所有</footer> 
        </div>

    </body>
    <script type="text/javascript"> 
/**
   * 设置cookie方法
   * @param   {string}  c_name  cookie键值
   * @param   {string}  value  cookie值
   * @param   {Boolean}  domain  判断是否需要跨域
   * @return  {*}  返回cookie值
   */
function setCookie_log (c_name,value,domain){
    var exdate = new Date(), expiredays = 365;
    exdate.setDate(exdate.getDate() + expiredays);
    //判断是否需要跨域存储
    if (domain) {
        document.cookie = c_name+ "=" +escape(value)+((expiredays==null) ? "" : ";expires="+exdate.toGMTString())+";path=/;domain=" + domain;
    } else {
        document.cookie = c_name+ "=" +escape(value)+((expiredays==null) ? "" : ";expires="+exdate.toGMTString())+";path=/";
    }   
  }
  /**
   * 获取cookie方法
   * @param   {string}  name  cookie键值
   * @return  {*}  返回cookie值
   */
  function getCookie_log(name){
    if (document.cookie.length>0){
      var start=document.cookie.indexOf(name + "=");
      if(start != -1){
        start = start + name.length + 1;
        var end = document.cookie.indexOf(";",start);
        if (end == -1){
          end = document.cookie.length;
        }
        return unescape(document.cookie.substring(start,end));
      }
    }
  }
    function getCookie(c_name)
    {
        if (document.cookie.length>0)
        {
            c_start=document.cookie.indexOf(c_name + "=")
            if (c_start!=-1)
            { 
                c_start=c_start + c_name.length+1 
                c_end=document.cookie.indexOf(";",c_start)
                if (c_end==-1) c_end=document.cookie.length
                return unescape(document.cookie.substring(c_start,c_end))
            } 
        }
        return ""
    }

    if(username=getCookie('username') != "")
    {
        window.location.href= "starter-devices.html";
    }

function createXHR() {
    if(typeof XMLHttpRequest != "undefined"){
    return new XMLHttpRequest();
}else if(typeof ActiveXObject != "undefined"){
    if(typeof arguments.callee.activeXString != "string"){
    var versions = ["MSXML2.XMLHttp.6.0", "MSXML2.XMLHttp.3.0", "MSXML2.XMLHttp"];

    for(var i=0, len=versions.length;i < len; i++){
    try{
    var xhr = new ActiveXObject(versions[i]);
    arguments.callee.activeXString = versions[i];
    return xhr;
}catch(ex){
    //跳过
}
}
}
    return new ActiveXObject(arguments.callee.activeXString);
}else{
    throw new Error("NO XHR object available");
}
}

    function show_error()
    {
        var obj = document.getElementById("ajaxloader3");
        var error_log = document.getElementById("error_log");
        obj.style.visibility= "hidden";
        error_log.style.visibility= "visible";
    }

    function doPost() { // to:提交动作（action）,p:参数 


    if(document.getElementById("input_user").value == ""|| 
        document.getElementById("input_pass").value == "")
        {
            var error_log = document.getElementById("error_log");
            error_log.style.visibility= "visible";
            return;
        }

    //alert("http://"+ document.getElementById("input_user").value + "." +host+ "/login.cgi") 
    var obj = document.getElementById("ajaxloader3");
    var error_log = document.getElementById("error_log");
    obj.style.visibility= "visible";
    error_log.style.visibility= "hidden";


    var xhr = createXHR();
    //xhr.open("POST", "http://" + document.getElementById("input_user").value +'.'+ witkit_server + ":8080/auth", true);
    xhr.open("POST", "http://" + document.getElementById("input_user").value +"."+ witkit_server + ":8080/auth", true);

    //xhr.setRequestHeader("X-Requested-With", "XMLHttpRequest"); //请求头部，需要服务端同时设置
    //xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
    xhr.withCredentials = true; // 设置运行跨域操作  

    //注册相关事件回调处理函数
    xhr.onload = function(e) { 
        if(this.status == 200||this.status == 304){
            //window.location.href="http://"+ document.getElementById("input_user").value + "." +host+ "/static/login/Login_v10/Login_v10/goto_starter.html";
            obj = JSON.parse(xhr.response);
            if(obj.result && obj.error == null){
                //document.cookie="sessionID="+obj.result;
                var Days = 30;
                var exp = new Date();
                exp.setTime(exp.getTime() + 24 * 60 * 60000);//过期时间 60分钟

                document.cookie="sessionid=" + obj.result + ";  path=/; expires=" + exp.toGMTString();
                document.cookie="username=" + document.getElementById("input_user").value + ";  path=/; expires=" + exp.toGMTString();
                document.cookie="serverdomain=" + witkit_server + ";  path=/; expires=" + exp.toGMTString();
                document.cookie="serverdomain=" + witkit_server + ";  path=/; expires=" + exp.toGMTString()+ ";domain=demonelf12.witkit.cn";
                //document.cookie="sessionid=" + obj.result + ";  path=/; domain="  + getCookie('serverdomain') + "; expires=" + exp.toGMTString();
                //alert("sessionid=" + obj.result + ";  path=/; domain=" + document.getElementById("input_user").value + '.' + getCookie('serverdomain'));
                //window.location.href= "starter.html";
                setCookie_log("sessionid", obj.result, document.getElementById("input_user").value +'.'+ witkit_server);
                setCookie_log("sessionid", obj.result, "6800." + document.getElementById("input_user").value +'.'+ witkit_server);
                window.location.href= "starter-devices.html";
            }
            else{
                show_error();
            }
        }
    };

    xhr.send(JSON.stringify({
        "jsonrpc"  :  "2.0",
        "method"   :  "auth",
        "params" :  [document.getElementById("input_user").value, document.getElementById("input_pass").value]
    }));
} 

    document.onkeydown = function (e) {
    var theEvent = window.event || e;
    var code = theEvent.keyCode || theEvent.which;
    if (code == 13) {
    $("#but1").click();
}
}
    </script> 

</html>
